/* Prevel Framework v1.0.0
 * http://github.com/chernikovalexey/Prevel
 * 
 * Copyright 2011, Alexey Chernikov
 * Dual licensed under the:
 *  - GNU LGPL (http://opensource.org/licenses/lgpl-license.php)
 *  - MIT License (http://opensource.org/licenses/mit-license.php)
 * 
 * =====
 * 
 * Contains YASS v0.3.9
 * http://yass.webo.in
 * 
 * Copyright 2008-2009, Nikolay Matsievsky (sunnybear)
 * Dual licensed under the:
 *  - MIT License (http://opensource.org/licenses/mit-license.php)
 *  - GNU GPL (http://opensource.org/licenses/gpl-license.php)
**/
(function(win,doc,uf){var proto="prototype",ael="addEventListener",ge="getElement",cn="className",nn="null",u="undef",newRegExp="<([A-z]+)>",n=null,ef=function(){};var types={"function":"fn",object:"obj",number:"int",string:"str","boolean":"bool","undefined":u};var fixAttr={className:"class",cssFloat:"float",htmlFor:"for"};var accessors=!!Object[proto].__lookupGetter__&&!!Object[proto].__lookupSetter__;var classSupport=!!doc[ge+"sByClassName"],qsSupport=!!doc.querySelectorAll;var ua=win.navigator.userAgent.toLowerCase();var pl=function(){return function(a,b,c){return new pl.fn.init(a,b,c)}}();pl.extend=function(a,b){if(!b){b=a;a=pl}if(accessors){var c,d;for(var e in b){c=b.__lookupGetter__(e);d=b.__lookupSetter__(e);if(c||d){if(c)a.__defineGetter__(e,c);if(d)a.__defineSetter__(e,d)}else if(!a[e]){a[e]=b[e]}}}else{for(var e in b){if(!a[e]){a[e]=b[e]}}}return a};pl.implement=function(a,b){return pl.extend(a[proto],b)};pl.extend({isArray:Array.isArray||function(a){return Object[proto].toString.call(a)==="[object Array]"},type:function(a,b){var c;if(pl.isArray(a)){c="arr"}else if(a instanceof RegExp){c="regexp"}else if(a instanceof Date){c="date"}else if(a===n){c=nn}else{c=types[typeof a]}return b?c===b:c},empty:function(a){if(pl.type(a,"obj")){for(var b in a)return false;return true}return pl.type(a,nn)||pl.type(a,u)||!a.length},trim:function(a){return String[proto].trim?a.trim():a.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},each:function(a,b){var c=a.length;while(--c>-1){b.call(a[c],c,a[c])}},inArray:function(a,b){if(Array[proto].indexOf)return b.indexOf(a);pl.each(b,function(b){if(a===this){return b}});return-1}});pl.extend({fn:{}});pl.extend(pl.fn,{init:function(){return function(a,b,c){var d;switch(pl.type(a)){case"str":var e=a.match(newRegExp);if(e){d=[create(e[1],b)]}else{switch(pl.type(b)){case"str":switch(pl.type(c)){case"int":d=[pl.find(a,b)[c]];break;default:case u:d=pl.find(a);break}break;case"int":d=[pl.find(a)[b]];break;default:case u:d=pl.find(a);break}}break;case"fn":Events.ready(a);break;case"obj":d=[a];break}this.elements=d;this.selector=arguments;__this=this;return this}}(),len:function(){return this.elements.length},last:function(){var a=this.elements.length;this.elements=[a?this.elements[a-1]:n];return this},html:function(a,b){return inner(this,"innerHTML",a,b)},text:function(a,b){return inner(this,innerText,a,b)},get:function(a){var b=this.elements;return b.length===1?b[0]:!pl.type(a,u)?b[a]:b},parent:function(a){if(!a)var a=1;var b=function(a,c){if(c>0){return b(a.parentNode,--c)}return a};return b(this.elements[0],a)},remove:function(){pl.each(this.elements,function(){this.parentNode.removeChild(this)});return this},addClass:function(a){pl.each(this.elements,function(){if(pl.inArray(a,this[cn].split(" "))!==-1)return;this[cn]+=(this[cn]?" ":"")+a});return this},hasClass:function(a){return pl.inArray(a,this.elements[0][cn].split(" "))!==-1},removeClass:function(a){pl.each(this.elements,function(){var b=this[cn].split(" ");var d=pl.inArray(a,b);if(d===-1)return;b.splice(d,1);if(pl.empty(b)){this.removeAttribute("class")}else{this[cn]=b.join(" ")}});return this},attr:function(a,b){a=fixAttr[a]||a;if(b){pl.each(this.elements,function(){this.setAttribute(a,b)})}else{switch(pl.type(a)){case"obj":for(var c in a){arguments.callee.call(this,c,a[c])}break;case"str":return this.elements[0].getAttribute(a);break}}return this},removeAttr:function(a){a=fixAttr[a]||a;pl.each(this.elements,function(){this.removeAttribute(a)});return this},css:function(a,b){if(b){a=curCSS.fixStyle(a);if(pl.type(b,"int")&&!curCSS.rmvPostFix[a]){b+="px"}else if(a==="opacity"){var c=curCSS.fixOpacity(b),a=c[0],b=c[1]}pl.each(this.elements,function(){this.style[a]=b})}else{switch(pl.type(a)){case"obj":for(var d in a){arguments.callee.call(this,d,a[d])}break;case"str":return curCSS.get(this.elements[0],a);break}}return this},each:function(a){pl.each(__this.elements,function(){a.call(this)});return this},bind:function(a,b){return Events.routeEvent(a,b,1)},unbind:function(a,b){return Events.routeEvent(a,b,0)},show:function(){pl.each(this.elements,function(){if(pl(this).css("display")!=="none")return;pl(this).css("display",this.getAttribute("plrd")||"")});return this},hide:function(){pl.each(this.elements,function(){var a=pl(this).css("display");if(a==="none")return;this.setAttribute("plrd",a);this.style.display="none"});return this},after:function(a){if(pl.type(a,"obj")){var b=doc.createElement("div");b.appendChild(a);a=b.innerHTML}pl.each(this.elements,function(){var b=this;var c=doc.createElement("div");c.innerHTML=a;try{pl.each(c.childNodes,function(){b.parentNode.insertBefore(this,b.nextSibling)})}catch(d){}});return this},before:function(a){if(pl.type(a,"obj")){var b=doc.createElement("div");b.appendChild(a);a=b.innerHTML}pl.each(this.elements,function(){var b=this;var c=doc.createElement("div");c.innerHTML=a;try{pl.each(c.childNodes,function(){b.parentNode.insertBefore(this,b)})}catch(d){}});return this},append:function(a){if(pl.type(a,"obj")){var b=doc.createElement("div");b.appendChild(a);a=b.innerHTML}pl.each(this.elements,function(){var b=this;var c=doc.createElement("div");c.innerHTML=a;try{pl.each(c.childNodes,function(){b.appendChild(this)})}catch(d){}});return this},prepend:function(a){if(pl.type(a,"obj")){var b=doc.createElement("div");b.appendChild(a);a=b.innerHTML}pl.each(this.elements,function(){var b=this;var c=doc.createElement("div");c.innerHTML=a;try{pl.each(c.childNodes,function(){b.insertBefore(this,b.firstChild)})}catch(d){}});return this}});pl.extend({toParams:function(a){if(!pl.type(a,"obj"))return a;var b=[];for(var c in a){b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]))}return b.join("&")},JSON:function(data){return!/[^,:{}[]0-9.-+Eaeflnr-u nrt]/.test(data.replace(/"(.|[^"])*"/g,""))&&eval("("+data+")")},browser:function(a){var b=/opera/i.test(ua),c=/chrome/i.test(ua);var d={opera:b,ie:!b&&/msie/i.test(ua),ie6:!b&&/msie 6/i.test(ua),ie7:!b&&/msie 7/i.test(ua),ie8:!b&&/msie 8/i.test(ua),firefox:/firefox/i.test(ua),chrome:c,safari_khtml:!c&&/khtml/i.test(ua),safari:!c&&/webkit|safari/i.test(ua)};for(var e in d){if(d[e]){return a===e||e}}},ajax:function(a){var b,c=a.load||ef,d=a.error||ef,e=a.success||ef;var f=function(){if(win.XMLHttpRequest){b=new XMLHttpRequest;if(b.overrideMimeType){b.overrideMimeType("text/html")}}else if(win.ActiveXObject){try{b=new ActiveXObject("Msxml2.XMLHTTP")}catch(f){try{b=new ActiveXObject("Microsoft.XMLHTTP")}catch(g){}}}if(!b){return alert("Could not create an XMLHttpRequest instance.")}b.onreadystatechange=function(f){switch(b.readyState){case 1:c();break;case 4:if(b.status===200){e(a.dataType==="json"?pl.JSON(b.responseText):b.responseText)}else{d(b.status)}break}}};var g=function(c){b.setRequestHeader("X-Requested-With","XMLHttpRequest");if(c){b.setRequestHeader("Content-type","application/x-www-form-urlencoded; charset="+(a.charset||"utf-8"))}};a.type=a.type||"POST";a.data=pl.toParams(a.data||{});a.async=a.async||true;f();switch(a.type){case"POST":b.open("POST",a.url,a.async);g(1);b.send(a.data);break;case"GET":b.open("GET",a.url+"?"+a.data,a.async);g();b.send(n);break}}});pl.extend({find:function(a){pl.extend(a,{attr:{"":function(a,b){return!!a.getAttribute(b)},"=":function(a,b,c){return(b=a.getAttribute(b))&&b===c},"&=":function(a,b,c){return;(b=a.getAttribute(b))&&(new RegExp("(^| +)"+c+"($| +)")).test(b)},"^=":function(a,b,c){return;(b=a.getAttribute(b)+"")&&!b.indexOf(c)},"$=":function(a,b,c){return;(b=a.getAttribute(b)+"")&&b.indexOf(c)===b.length-c.length},"*=":function(a,b,c){return;(b=a.getAttribute(b)+"")&&b.indexOf(c)!=-1},"|=":function(a,b,c){return;(b=a.getAttribute(b)+"")&&(b===c||!!b.indexOf(c+"-"))},"!=":function(a,b,c){return;!(b=a.getAttribute(b))||!(new RegExp("(^| +)"+c+"($| +)")).test(b)}},mods:{"first-child":function(a){return a.parentNode[ge+"sByTagName"]("*")[0]!==a},"last-child":function(a){var b=a;while((b=b.nextSibling)&&b.nodeType!=1){}return!!b},root:function(a){return a.nodeName.toLowerCase()!=="html"},"nth-child":function(a,b){var c=a.nodeIndex||0,d=b[3]=b[3]?(b[2]==="%"?-1:1)*b[3]:0,e=b[1];if(c){return!((c+d)%e)}else{var f=a.parentNode.firstChild;c++;do{if(f.nodeType==1&&(f.nodeIndex=++c)&&a===f&&(c+d)%e){return 0}}while(f=f.nextSibling);return 1}},"nth-last-child":function(a,b){var c=a.nodeIndexLast||0,d=b[3]?(b[2]==="%"?-1:1)*b[3]:0,e=b[1];if(c){return!((c+d)%e)}else{var f=a.parentNode.lastChild;c++;do{if(f.nodeType==1&&(f.nodeLastIndex=c++)&&a===f&&(c+d)%e){return 0}}while(f=f.previousSibling);return 1}},empty:function(a){return!!a.firstChild},parent:function(a){return!a.firstChild},"only-child":function(a){return a.parentNode[ge+"sByTagName"]("*").length!=1},checked:function(a){return!a.checked},lang:function(a,b){return a.lang!==b&&doc.documentElement.lang!==b},enabled:function(a){return a.disabled||a.type==="hidden"},disabled:function(a){return!a.disabled},selected:function(a){child.parentNode.selectedIndex;return!child.selected}}});return function(b,c){if(c){b=c+" "+b}c=doc;var d=[];if(b==="body *"){return doc.body[ge+"sByTagName"]("*")}else if(/^[\w[:#.][\w\]*^|=!]*$/.test(b)){var e=0;switch(b.charAt(0)){case"#":e=b.slice(1);d=doc[ge+"ById"](e);if(pl.browser("ie")&&d.id!==e){d=doc.all[e]}d=d?[d]:[];break;case".":var f=b.slice(1);if(classSupport){d=(e=(d=c[ge+"sByClassName"](f)).length)?d:[]}else{f=" "+f+" ";var g=c[ge+"sByTagName"]("*"),h=0,i;while(i=g[h++]){if((" "+i[cn]+" ").indexOf(f)!=-1){d[e++]=i}}d=e?d:[]}break;case":":var i,g=c[ge+"sByTagName"]("*"),h=0,j=b.replace(/[^(]*\(([^)]*)\)/,"$1"),k=b.replace(/\(.*/,"");while(i=g[h++]){if(a.mods[k]&&!a.mods[k](i,j)){d[e++]=i}}d=e?d:[];break;case"[":var g=c[ge+"sByTagName"]("*"),i,h=0,l=/\[([^!~^*|$ [:=]+)([$^*|]?=)?([^ :\]]+)?\]/.exec(b),m=l[1],o=l[2]||"",p=l[3];while(i=g[h++]){if(a.attr[o]&&(a.attr[o](i,m,p)||m==="class"&&a.attr[o](i,cn,p))){d[e++]=i}}d=e?d:[];break;default:d=(e=(d=c[ge+"sByTagName"](b)).length)?d:[];break}}else{if(qsSupport&&b.indexOf("!=")==-1){d=c.querySelectorAll(b.replace(/=([^\]]+)/,'="$1"'))}else{var q=b.split(/ *, */),r=q.length-1,s=!!r,t,u,v,w,h,x,g,y,z,f,m,o,k,j,A,e,B,C,D,E,F,G;while(t=q[r--]){v=(u=t.replace(/(\([^)]*)\+/,"$1%").replace(/(\[[^\]]+)~/,"$1&").replace(/(~|>|\+)/," $1 ").split(/ +/)).length;h=0;x=" ";g=[c];while(w=u[h++]){if(w!==" "&&w!==">"&&w!=="~"&&w!=="+"&&g){w=w.match(/([^[:.#]+)?(?:#([^[:.#]+))?(?:\.([^[:.]+))?(?:\[([^!&^*|$[:=]+)([!$^*|&]?=)?([^:\]]+)?\])?(?:\:([^(]+)(?:\(([^)]+)\))?)?/);y=w[1]||"*";z=w[2];f=w[3]?" "+w[3]+" ":"";m=w[4];o=w[5]||"";k=w[7];j=k==="nth-child"||k==="nth-last-child"?/(?:(-?\d*)n)?(?:(%|-)(\d*))?/.exec(w[8]==="even"&&"2n"||w[8]==="odd"&&"2n%1"||!/\D/.test(w[8])&&"0n%"+w[8]||w[8]):w[8];A=[];e=B=0;D=h==v;while(C=g[B++]){switch(x){case" ":E=C[ge+"sByTagName"](y);G=0;while(F=E[G++]){if((!z||F.id===z)&&(!f||(" "+F[cn]+" ").indexOf(f)!=-1)&&(!m||a.attr[o]&&(a.attr[o](F,m,w[6])||m==="class"&&a.attr[o](F,cn,w[6])))&&!F.yeasss&&!(a.mods[k]?a.mods[k](F,j):k)){if(D){F.yeasss=1}A[e++]=F}}break;case"~":y=y.toLowerCase();while((C=C.nextSibling)&&!C.yeasss){if(C.nodeType==1&&(y==="*"||C.nodeName.toLowerCase()===y)&&(!z||C.id===z)&&(!f||(" "+C[cn]+" ").indexOf(f)!=-1)&&(!m||a.attr[o]&&(a.attr[o](F,m,w[6])||m==="class"&&a.attr[o](F,cn,w[6])))&&!C.yeasss&&!(a.mods[k]?a.mods[k](C,j):k)){if(D){C.yeasss=1}A[e++]=C}}break;case"+":while((C=C.nextSibling)&&C.nodeType!=1){}if(C&&(C.nodeName.toLowerCase()===y.toLowerCase()||y==="*")&&(!z||C.id===z)&&(!f||(" "+F[cn]+" ").indexOf(f)!=-1)&&(!m||a.attr[o]&&(a.attr[o](F,m,w[6])||m==="class"&&a.attr[o](F,cn,w[6])))&&!C.yeasss&&!(a.mods[k]?a.mods[k](C,j):k)){if(D){C.yeasss=1}A[e++]=C}break;case">":E=C[ge+"sByTagName"](y);h=0;while(F=E[h++]){if(F.parentNode===C&&(!z||F.id===z)&&(!f||(" "+F[cn]+" ").indexOf(f)!=-1)&&(!m||a.attr[o]&&(a.attr[o](F,m,w[6])||m==="class"&&a.attr[o](F,cn,w[6])))&&!F.yeasss&&!(a.mods[k]?a.mods[k](F,j):k)){if(D){F.yeasss=1}A[e++]=F}}break}}g=A}else{x=w}}if(s){if(!g.concat){A=[];G=0;while(F=g[G]){A[G++]=F}g=A}d=g.concat(d.length==1?d[0]:d)}else{d=g}}e=d.length;while(e--){d[e].yeasss=d[e].nodeIndex=d[e].nodeIndexLast=n}}}return d}}({})});var innerText=pl.browser("ie")?"innerText":"textContent";var Events={ready:function(){this.readyList=[];this.bindReady=function(a){function c(){if(b)return;b=true;a()}var b=false;if(doc[ael]){Events.attaches.bind(doc,"DOMContentLoaded",c)}else if(doc.attachEvent){if(doc.documentElement.doScroll&&win===win.top){function d(){if(b)return;if(!doc.body)return;try{doc.documentElement.doScroll("left");c()}catch(a){setTimeout(d,0)}}d()}Events.attaches.bind(doc,"readystatechange",function(){if(doc.readyState==="complete"){c()}})}Events.attaches.bind(win,"load",c)};var a=this;return function(b){if(!a.readyList.length){a.bindReady(function(){pl.each(a.readyList,function(a){this()})})}a.readyList.push(b)}}(),attaches:function(){function c(a){a=b(a);var c=this.evt[a.type];for(var d in c){var e=c[d].call(this,a);if(!e){a.preventDefault();a.stopPropagation()}}}function b(a){a=a||win.event;if(a.fixed){return a}a.fixed=true;a.preventDefault=a.preventDefault||function(){this.returnValue=false};a.stopPropagation=a.stopPropagation||function(){this.cancelBubble=true};if(!a.target){a.target=a.srcElement}if(!a.which&&a.button){a.which=a.button&1?1:a.button&2?3:a.button&4?2:0}return a}var a=0;return{bind:function(b,d,e){if(pl.browser("ie")&&b.setInterval&&b!==win){b=win}if(!e.turnID){e.turnID=++a}if(!b.evt){b.evt={};b.handleEvt=function(a){if(!pl.type(Events.attaches,u)){return c.call(b,a)}}}if(!b.evt[d]){b.evt[d]={};if(b[ael]){b[ael](d,b.handleEvt,false)}else{b.attachEvent("on"+d,b.handleEvt)}}b.evt[d][e.turnID]=e},unbind:function(a,b,c){var d=a.evt&&a.evt[b];if(!d)return;delete d[c.turnID];for(var e in d)return;if(a.removeEventListener){a.removeEventListener(b,a.handleEvt,false)}else{a.detachEvent("on"+b,a.handleEvt)}delete a.evt[b];for(var e in a.evt)return;try{delete a.handleEvt;delete a.evt}catch(f){a.removeAttribute("handleEvt");a.removeAttribute("evt")}}}}(),routeEvent:function(a,b,c){if(b){if(c){pl.each(__this.elements,function(){Events.attaches.bind(this,a,b)})}else{pl.each(__this.elements,function(){Events.attaches.unbind(this,a,b)})}}else{for(var d in a){arguments.callee(d,a[d],c)}}return __this}};var inner=function(a,b,c,d){var e=a;var a=e.elements[0];if(!c){return a[b]}else{if(!d){a[b]=c}else{switch(d){case 1:pl.each(e.elements,function(){this[b]+=c});break;case-1:pl.each(e.elements,function(){this[b]=c+this[b]});break}}return e}};var create=function(a,b){var c=doc.createElement(a);return b?pl.extend(c,b):c};var curCSS={fixStyle:function(a){if(!a.match("-"))return a;var b=a.split("-");return b[0]+b[1].toUpperCase()},fixOpacity:function(a){var b="opacity",c=[b,a];switch(pl.browser()){case"ie7":c[0]="filter";c[1]="alpha("+b+"="+a*100+");";break;case"ie8":c[0]="-ms-filter";c[1]="alpha("+b+"="+a*100+")";break;case"safari_khtml":c[0]="-khtml-"+b;break;case"firefox":c[0]="-moz-"+b;break}return c},fixReturnOpacity:function(a){return a?a.match("opacity=")?a.match("=([0-9]+)")[1]/100:a:n},rmvPostFix:{zIndex:true,fontWeight:true,opacity:true,zoom:true,lineHeight:true},get:function(a,b){if(b==="opacity"){var c=curCSS.fixOpacity(0),b=c[0]}return curCSS.fixReturnOpacity(a.currentStyle?a.currentStyle[b]:win.getComputedStyle(a,n).getPropertyValue(b))}};pl.implement(pl.fn.init,pl.fn);win.pl=win.prevel=pl})(this,document)